

@{
    ViewBag.Title = "All";
    Layout = "~/Views/Shared/_SmartAdmin.cshtml";
}

<script src="~/Content/js/Plugins/treeView/ui.custom.js"></script>
<script src="~/Content/js/Plugins/treeView/dynatree.js"></script>

<link href="~/Content/js/Plugins/treeView/skin/ui.dynatree.css" rel="stylesheet" />

<style>
    .column-header-anchor {
        color: white;
    }
</style>




<style>
    /* The switch - the box around the slider */
    .switch {
        position: relative;
        display: inline-block;
        /*width: 60px;
    height: 34px;*/
        width: 35px;
        height: 16px;
    }

        /* Hide default HTML checkbox */
        .switch input {
            display: none;
        }

    /* The slider */
    .slider1 {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #f15353; /*#ccc*/
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider1:before {
            position: absolute;
            content: "";
            height: 10px;
            width: 10px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider1 {
        background-color: forestgreen; /*#2196F3;*/
    }

    input:focus + .slider1 {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider1:before {
        -webkit-transform: translateX(18px);
        -ms-transform: translateX(18px);
        transform: translateX(18px);
    }

    .modal-body {
        /*padding: 50px;*/
        padding-top: 0px;
    }

    .smart-form fieldset {
        padding-top: 0px;
    }

    .smart-form footer {
        border-top: none;
        background: none;
    }
</style>

























<div class="row">
    <div class="col-md-12">
        <div class="box box-solid">
            <div class="box-header with-border">
                <h3 class="box-title">User Equipments</h3>
                <!--Top Right Buttons-->
                @if (ViewBag.AllowUri("/Equipment/New"))
                {
                    <a href="@Url.Action("New","Equipment")" class="btn btn-sm btn-info btn-flat pull-right" style="margin-left:2px"><i class="fa fa-mobile"></i> Add New Device</a>

                }
                @if (ViewBag.AllowUri("/Equipment/Movement"))
                {
                    @*<a href="@Url.Action("Movement","Equipment")" class="btn btn-sm btn-info btn-flat pull-right"><i class="fa fa-plus-square"></i>  New Transaction</a>*@
                }

            </div>
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#wid-id-1" data-toggle="tab" aria-expanded="true">User Equipments</a></li>
                    <li class=""><a href="#wid-id-2" data-toggle="tab" aria-expanded="false">Assigned Devices</a></li>
                    <li class=""><a href="#wid-id-3" data-toggle="tab" aria-expanded="false">Available Devices</a></li>
                    <li class="pull-right"><a href="#" class="text-muted"></a></li>
                </ul>
                <div class="tab-content">

                    <div class="jarviswidget active jarviswidget-color-blueDark tab-pane" id="wid-id-1" data-widget-editbutton="false">
                        <header>
                            @if (ViewBag.AllowUri("/Equipment/Edit"))
                            {
                                <label class="switch pull-right" style="margin-top:9px; margin-right:15px;">
                                    <input type="checkbox" id="IsActive" />
                                    <span class="slider1" title="View Active/InActive"></span>
                                </label>
                            }
                            <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                            <h2>User Equipments </h2>
                        </header>

                        <!-- widget div-->
                        <div>
                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->
                            </div>
                            <!-- end widget edit box -->
                            <!-- widget content -->
                            <div class="widget-body no-padding">
                                <table id="datatable_fixed_column" class="table table-striped table-bordered context-menu-one" width="100%">
                                    <thead>
                                        <tr>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UE Type" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Manufacturer" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Model" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Serial No" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="MAC" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UENumber" />
                                            </th>
                                        </tr>
                                        <tr>
                                            <th style="color:black" data-column-id="Device">UE Type</th>
                                            <th style="color:black" data-column-id="Manufacturer">Manufacturer</th>
                                            <th style="color:black" data-column-id="Model">Model</th>
                                            <th style="color:black" data-column-id="SerialNo">Serial No</th>
                                            <th style="color:black" data-column-id="MAC">MAC</th>
                                            <th style="color:black" data-column-id="UE Number">UENumber</th>
                                            <th style="color:black">Action</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>

                            <!-- end widget content -->
                        </div>
                        <!-- end widget div -->
                    </div>

                    <div class="jarviswidget jarviswidget-color-blueDark tab-pane" id="wid-id-2" data-widget-editbutton="false">
                        <header>
                            <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                            <h2>Assigned Devices</h2>
                        </header>

                        <!-- widget div-->
                        <div>
                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->
                            </div>
                            <!-- end widget edit box -->
                            <!-- widget content -->
                            <div class="widget-body no-padding">
                                <table id="datatable_fixed_column2" class="table table-striped table-bordered" width="100%">
                                    <thead>
                                        <tr>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UE Type" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Manufacturer" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Model" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Serial No" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="MAC" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UENumber" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UserId" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UserName" />
                                            </th>
                                        </tr>
                                        <tr>
                                            <th style="color:black" data-column-id="Device">UE Type</th>

                                            <th style="color:black" data-column-id="Manufacturer">Manufacturer</th>
                                            <th style="color:black" data-column-id="Model">Model</th>
                                            <th style="color:black" data-column-id="SerialNo">Serial No</th>
                                            <th style="color:black" data-column-id="MAC">MAC</th>
                                            <th style="color:black" data-column-id="UENumber">UE Number</th>
                                            <th style="color:black" data-column-id="UserId">User Id</th>
                                            <th style="color:black" data-column-id="UserFullName">User Name</th>
                                            <th style="color:black;width:80px">Action</th>
                                        </tr>
                                    </thead>

                                </table>

                            </div>
                            <!-- end widget content -->
                        </div>
                        <!-- end widget div -->
                    </div>

                    <!-- /.tab-pane -->
                    <div class="jarviswidget jarviswidget-color-blueDark tab-pane" id="wid-id-3" data-widget-editbutton="false">

                        <header>
                            <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                            <h2>Available Devices </h2>
                        </header>

                        <!-- widget div-->
                        <div>
                            <!-- widget edit box -->
                            <div class="jarviswidget-editbox">
                                <!-- This area used as dropdown edit box -->
                            </div>
                            <!-- end widget edit box -->
                            <!-- widget content -->
                            <div class="widget-body no-padding">
                                <table id="datatable_fixed_column3" class="table table-striped table-bordered" width="100%">
                                    <thead>
                                        <tr>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UE Type" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Manufacturer" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Model" />
                                            </th>
                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="Serial No" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="MAC" />
                                            </th>

                                            <th class="hasinput">
                                                <input type="text" class="form-control" placeholder="UENumber" />
                                            </th>
                                        </tr>
                                        <tr>
                                            <th style="color:black" data-column-id="Device">UE Type</th>
                                            <th style="color:black" data-column-id="Manufacturer">Manufacturer</th>
                                            <th style="color:black" data-column-id="Model">Model</th>
                                            <th style="color:black" data-column-id="SerialNo">Serial No</th>
                                            <th style="color:black" data-column-id="MAC">MAC</th>
                                            <th style="color:black" data-column-id="UENumber">UENumber</th>
                                            <th style="color:black">Action</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <!-- end widget content -->
                        </div>
                        <!-- end widget div -->
                    </div>



                    <!-- User Applications popup -->
                    <fieldset>
                        <div class="modal  fade" id="TaskModal">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header" style="background-color:#4c4f53;color:white!important">
                                        <button type="button" style="color:white" class="close" data-dismiss="modal" aria-hidden="true">
                                            ×
                                        </button>
                                        <h4 class="modal-title" style="color:white">Applications</h4>
                                    </div>
                                    <div class="modal-body" style="overflow:hidden;">
                                        <div id="myTabContent1" class="tab-content padding-10">
                                            <div class="tab-pane fade active in">
                                                <div class="row">
                                                    @Html.Action("ModuleApps", "Equipment")
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>


                    <!-- UE issues popup with tabs -->

                    <div class="modal fade" id="TaskModalIssues">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header" style="background-color:#4c4f53;color:white!important;margin-bottom:10px;">
                                    <button type="button" style="color:white" class="close" data-dismiss="modal" aria-hidden="true">
                                        ×
                                    </button>
                                    <h4 class="modal-title" style="color:white">UE Issues</h4>
                                </div>

                                <div class="modal-body" style="overflow:hidden;">
                                    <div class="nav-tabs-custom">
                                        <ul class="nav nav-tabs boxHeader">
                                            <li class="active"><a href="#divAddIssue" data-toggle="tab" aria-expanded="true">Report Issue</a></li>
                                            <li><a href="#divIssuesDetail" data-toggle="tab">Issues Detail</a></li>
                                        </ul>
                                        <div class="tab-content boxBody">
                                            <div class="tab-pane active" id="divAddIssue">
                                                <div class="row">
                                                    @Html.Action("UEIssues", "Equipment")
                                                </div>
                                            </div>

                                            <div class="tab-pane" id="divIssuesDetail">
                                                <div class="row">
                                                    <br />
                                                    <table id="tblIssues" style="width:98%;margin-left:10px;" class="table table-striped table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>UE Id</th>
                                                                <th>Description</th>
                                                                <th>Reported Date</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                                <input type="button" id="btn-close" value="Close" data-dismiss="modal" class="btn btn-primary pull-right" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                       <!-- 
                           <fieldset>
                                <div class="modal  fade" id="TaskModalIssues">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header" style="background-color:#4c4f53;color:white!important">
                                                <button type="button" style="color:white" class="close" data-dismiss="modal" aria-hidden="true">
                                                    ×
                                                </button>
                                                <h4 class="modal-title" style="color:white">Add UE Issue</h4>
                                            </div>

                                            <div class="modal-body" style="overflow:hidden;">
                                                <div id="IssuesDiv" class="tab-content padding-10">
                                                    <div class="tab-pane fade active in">
                                                        <div class="row">
                                                            @Html.Action("UEIssues", "Equipment")
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset> -->




                        <!--Third popup-->
                        <!-- 
                             <fieldset>
                            <div class="modal  fade" id="UEIssuesListxxxxx">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header" style="background-color:#4c4f53;color:white!important">
                                            <button type="button" style="color:white" class="close" data-dismiss="modal" aria-hidden="true">
                                                ×
                                            </button>
                                            <h4 class="modal-title" style="color:white">UE Issue</h4>
                                        </div>

                                        <div class="modal-body" style="overflow:hidden;">
                                            <div id="IssuesDiv" class="tab-content padding-10">
                                                <div class="tab-pane fade active in">
                                                    <div class="row">
                                                        <table id="tblIssues" style="width:100%" class="table table-striped table-bordered">
                                                            <thead>
                                                                <tr>
                                                                    <th>ID</th>
                                                                    <th>UE Id</th>
                                                                    <th>Description</th>
                                                                    <th>Reported Date</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <input type="button" id="btn-close" value="Close" data-dismiss="modal" class="btn btn-primary pull-right" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                             -->
                       

                    </div>
                </div>
            </div>
        </div>
        <!-- /.tab-content -->
    </div>



    @section scripts{
        <script src="~/Content/js/Plugins/bootgrid/jquery.bootgrid.js"></script>
        <script src="~/Content/js/Plugins/ContextMenu/contextMenu.min.js"></script>
        <script src="~/SmartAdmin/js/plugin/datatables/jquery.dataTables.min.js"></script>
        <script src="~/SmartAdmin/js/plugin/datatables/dataTables.colVis.min.js"></script>
        <script src="~/SmartAdmin/js/plugin/datatables/dataTables.tableTools.min.js"></script>
        <script src="~/SmartAdmin/js/plugin/datatables/dataTables.bootstrap.min.js"></script>

        <script src="~/SmartAdmin/js/plugin/datatable-responsive/datatables.responsive.min.js"></script>

        <script>

            var responsiveHelper_dt_basic = undefined;
            var responsiveHelper_datatable_fixed_column = undefined;

            var responsiveHelper_datatable_col_reorder = undefined;
            var responsiveHelper_datatable_tabletools = undefined;

            var otable = undefined;
            var otable1 = undefined;
            var otable2 = undefined;

            var breakpointDefinition = {
                tablet: 1024,
                phone: 480
            };


            var AllowEdit = '@ViewBag.AllowUri("/Equipment/Edit")';

            var DeActiveUE = '@ViewBag.AllowUri("/Equipment/DeActiveUE")';
            var ReturnUE = '@ViewBag.AllowUri("/Equipment/ReturnUE")';
            var TransferUE = '@ViewBag.AllowUri("/Equipment/TransferUE")';
            var IssueUE = '@ViewBag.AllowUri("/Equipment/IssueUE")';
            var AllowDownloadApp = '@ViewBag.AllowUri("/Equipment/AllowDownloadApp")';

            $(document).ready(function () {

                pageSetUp();

                /* BASIC ;*/
                //var responsiveHelper_dt_basic = undefined;
                //var responsiveHelper_datatable_fixed_column = undefined;

                //var responsiveHelper_datatable_col_reorder = undefined;
                //var responsiveHelper_datatable_tabletools = undefined;


                var IsActive = "True";

                $('#dt_basic').dataTable({
                    "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-12 hidden-xs'l>r>" +
                        "t" +
                        "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                    "autoWidth": true,
                    "preDrawCallback": function () {
                        // Initialize the responsive datatables helper once.
                        if (!responsiveHelper_dt_basic) {
                            responsiveHelper_dt_basic = new ResponsiveDatatablesHelper($('#dt_basic'), breakpointDefinition);
                        }
                    },
                    "rowCallback": function (nRow) {
                        responsiveHelper_dt_basic.createExpandIcon(nRow);
                    },
                    "drawCallback": function (oSettings) {
                        responsiveHelper_dt_basic.respond();
                    }
                });
                /* END BASIC */


                //--------[Table 1]
                otable = $('#datatable_fixed_column').DataTable({
                    "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>" +
                            "t" +
                            "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                    "autoWidth": true,
                    "preDrawCallback": function () {
                        // Initialize the responsive datatables helper once.
                        if (!responsiveHelper_datatable_fixed_column) {
                            responsiveHelper_datatable_fixed_column = new ResponsiveDatatablesHelper($('#datatable_fixed_column'), breakpointDefinition);
                        }
                    },
                    "rowCallback": function (nRow) {
                        responsiveHelper_datatable_fixed_column.createExpandIcon(nRow);
                    },
                    "drawCallback": function (oSettings) {
                        responsiveHelper_datatable_fixed_column.respond();
                    }
                });

                LoadUserEquipments(IsActive);

                $("div.toolbar").html('<div class="text-right"><img src="img/logo.png" alt="" style="width: 111px; margin-top: 3px; margin-right: 10px;"></div>');
                // Apply the filter
                $("#datatable_fixed_column thead th input[type=text]").on('keyup change', function () {
                    otable
                        .column($(this).parent().index() + ':visible')
                        .search(this.value)
                        .draw();
                });



                //--------[Table 2: Assigned devices]
                otable1 = $('#datatable_fixed_column2').DataTable({
                    "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>" +
                            "t" +
                            "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                    "autoWidth": true,
                    "preDrawCallback": function () {
                        // Initialize the responsive datatables helper once.
                        if (!responsiveHelper_datatable_fixed_column) {
                            responsiveHelper_datatable_fixed_column = new ResponsiveDatatablesHelper($('#datatable_fixed_column2'), breakpointDefinition);
                        }
                    },
                    "rowCallback": function (nRow) {
                        responsiveHelper_datatable_fixed_column.createExpandIcon(nRow);
                    },
                    "drawCallback": function (oSettings) {
                        responsiveHelper_datatable_fixed_column.respond();
                    }
                });

                LoadAssignedDevices();


                // custom toolbar
                $("div.toolbar").html('<div class="text-right"><img src="img/logo.png" alt="" style="width: 111px; margin-top: 3px; margin-right: 10px;"></div>');
                // Apply the filter
                $("#datatable_fixed_column2 thead th input[type=text]").on('keyup change', function () {
                    otable1
                        .column($(this).parent().index() + ':visible')
                        .search(this.value)
                        .draw();
                });
                /* END COLUMN FILTER */


                //--------[Table 3: Available devices]
                otable2 = $('#datatable_fixed_column3').DataTable({
                    "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>" +
                            "t" +
                            "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                    "autoWidth": true,
                    "preDrawCallback": function () {
                        // Initialize the responsive datatables helper once.
                        if (!responsiveHelper_datatable_fixed_column) {
                            responsiveHelper_datatable_fixed_column = new ResponsiveDatatablesHelper($('#datatable_fixed_column3'), breakpointDefinition);
                        }
                    },
                    "rowCallback": function (nRow) {
                        responsiveHelper_datatable_fixed_column.createExpandIcon(nRow);
                    },
                    "drawCallback": function (oSettings) {
                        responsiveHelper_datatable_fixed_column.respond();
                    }
                });

                LoadAvailableDevices();


                // custom toolbar
                $("div.toolbar").html('<div class="text-right"><img src="img/logo.png" alt="" style="width: 111px; margin-top: 3px; margin-right: 10px;"></div>');

                // Apply the filter
                $("#datatable_fixed_column3 thead th input[type=text]").on('keyup change', function () {
                    otable2
                        .column($(this).parent().index() + ':visible')
                        .search(this.value)
                        .draw();
                });
                /* END COLUMN FILTER */




                /* TABLETOOLS */
                $('#datatable_tabletools').dataTable({

                    // Tabletools options:
                    //   https://datatables.net/extensions/tabletools/button_options
                    "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'T>r>" +
                            "t" +
                            "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",
                    "oTableTools": {
                        "aButtons": [
                            "copy",
                            "csv",
                            "xls",
                               {
                                   "sExtends": "pdf",
                                   "sTitle": "SmartAdmin_PDF",
                                   "sPdfMessage": "SmartAdmin PDF Export",
                                   "sPdfSize": "letter"
                               },
                               {
                                   "sExtends": "print",
                                   "sMessage": "Generated by SmartAdmin <i>(press Esc to close)</i>"
                               }
                        ],
                        "sSwfPath": "js/plugin/datatables/swf/copy_csv_xls_pdf.swf"
                    },
                    "autoWidth": true,
                    "preDrawCallback": function () {
                        // Initialize the responsive datatables helper once.
                        if (!responsiveHelper_datatable_tabletools) {
                            responsiveHelper_datatable_tabletools = new ResponsiveDatatablesHelper($('#datatable_tabletools'), breakpointDefinition);
                        }
                    },
                    "rowCallback": function (nRow) {
                        responsiveHelper_datatable_tabletools.createExpandIcon(nRow);
                    },
                    "drawCallback": function (oSettings) {
                        responsiveHelper_datatable_tabletools.respond();
                    }
                });
                /* END TABLETOOLS */
            })


            $(".context-menu-one").contextMenu({
                selector: 'td',
                callback: function (key, options) {
                    var m = "clicked: " + key;
                    window.console && console.log(m) || alert(m);
                },
                items: {
                    "edit": { name: "Edit", icon: "edit" },
                    "cut": { name: "Cut", icon: "cut" },
                    copy: { name: "Copy", icon: "copy" },
                    "paste": { name: "Paste", icon: "paste" },
                    "delete": { name: "Delete", icon: "delete" },
                    "sep1": "---------",
                    "quit": {
                        name: "Quit", icon: function () {
                            return 'context-menu-icon context-menu-icon-quit';
                        }
                    }
                }
            });

            //$('.context-menu-one').on('click', function (e) {
            //    console.log('clicked', this);
            //})

        </script>
    }

    <script src="~/SmartAdmin/js/moment.min.js"></script>
    <script src="~/SmartAdmin/js/datetime-moment.js"></script>

    <script type="text/javascript">



        function LoadUserEquipments(IsActive) {
            $("#datatable_fixed_column").DataTable().destroy();

            otable = $('#datatable_fixed_column').DataTable({
                "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>" +
                        "t" +
                        "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                "autoWidth": true,
                "preDrawCallback": function () {
                    // Initialize the responsive datatables helper once.
                    if (!responsiveHelper_datatable_fixed_column) {
                        responsiveHelper_datatable_fixed_column = new ResponsiveDatatablesHelper($('#datatable_fixed_column'), breakpointDefinition);
                    }
                },
                "rowCallback": function (nRow) {
                    responsiveHelper_datatable_fixed_column.createExpandIcon(nRow);
                },
                "drawCallback": function (oSettings) {
                    responsiveHelper_datatable_fixed_column.respond();
                },
                "ajax": "/Equipment/ToList?filter=All&value=" + IsActive + "&value2=",
                "columns": [
                            { "data": "Device" }
                          , { "data": "Manufacturer" }
                          , { "data": "Model" }
                          , { "data": "SerialNo" }
                          , { "data": "MAC" }
                          , { "data": "UENumber" }
                          , {
                              render: function (data, type, row) {
                                  var permissions = "";
                                  if (AllowEdit == "True") {
                                      permissions = '<a href="/Equipment/Edit/' + row.UEId + '" class="table-edit" data-id="Id"><span title="Edit" class="glyphicon fa fa-pencil-square-o"></span></a>' + " &nbsp; "
                                  }
                                  if (DeActiveUE == "True") {
                                      if (IsActive == "True") {
                                          permissions += '<a href="#" onclick="IsActiveUE(' + row.SerialNo + ',\'false\'); return false;"><span style="color:red;" title="Deactive" class="glyphicon fa fa-times-circle-o"></span></a>'
                                      }
                                      else {
                                          permissions += '<a href="#" onclick="IsActiveUE(' + row.SerialNo + ',\'true\'); return false;" ><span style="color:green;" title="Activate" class="fa fa-check-circle"></span></a>'
                                      }
                                  }
                                  return permissions;
                              }
                          }
                ],
            });
        }

        function LoadAssignedDevices() {
            $("#datatable_fixed_column2").DataTable().destroy();
            otable1 = $('#datatable_fixed_column2').DataTable({
                "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>" +
                        "t" +
                        "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                "autoWidth": true,
                "preDrawCallback": function () {
                    // Initialize the responsive datatables helper once.
                    if (!responsiveHelper_datatable_fixed_column) {
                        responsiveHelper_datatable_fixed_column = new ResponsiveDatatablesHelper($('#datatable_fixed_column2'), breakpointDefinition);
                    }
                },
                "rowCallback": function (nRow) {
                    responsiveHelper_datatable_fixed_column.createExpandIcon(nRow);
                },
                "drawCallback": function (oSettings) {
                    responsiveHelper_datatable_fixed_column.respond();
                },
                "ajax": "/Equipment/ToList?filter=AssignedDevices&value=&value2=",
                "columns": [
                            { "data": "Device" }
                          , { "data": "Manufacturer" }
                          , { "data": "Model" }
                          , { "data": "SerialNo" }
                          , { "data": "MAC" }
                          , { "data": "UENumber" }
                          , { "data": "UserId", "bVisible": false }
                          , { "data": "UserFullName" }
                          , {
                              render: function (data, type, row) {
                                  var permissions = "";
                                  if (ReturnUE == "True") {
                                      permissions = '<a href="/equipment/movement?UEId=' + row.UEId + '&UserId=' + row.UserId + '&UETypeId=' + row.UETypeId + '&UEsts=Return"><span style="color:red;" title="Return Device" class="fa fa-arrow-circle-o-left"></span></a>' + " &nbsp; "
                                  }
                                  if (TransferUE == "True") {
                                      permissions += '<a href="/equipment/movement?UEId=' + row.UEId + '&UserId=' + row.UserId + '&UETypeId=' + row.UETypeId + '&UEsts=Transfer"><span style="color:red;" title="Transfer Device" class="fa fa-arrow-circle-o-right"></span></a>' + " &nbsp; "
                                  }
                                  if (AllowDownloadApp == "True") {

                                      permissions += '<a href="#" onclick="return theFunction(' + row.UEId + ',' + row.UserId + ');"  data-toggle="modal" data-target="#TaskModal"><span style="color:green;" title="Allow Download Apps" class="fa fa-arrow-circle-o-down"></span></a>' + " &nbsp; "
                                  }

                                  // if (ReportIssues == "True") {
                                  permissions += '<a href="#" onclick="return addUEIssue(' + row.UEId + ',' + row.UserId + ');"  data-toggle="modal" data-target="#TaskModalIssues"><span style="color:red;" title="Add UE Issue" class="fa fa-exchange"></span></a>'
                                  // }


                                  return permissions;
                              }
                          }
                ]
            });
        }

        function LoadAvailableDevices() {
            $("#datatable_fixed_column3").DataTable().destroy();
            otable2 = $('#datatable_fixed_column3').DataTable({
                "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6 hidden-xs'f><'col-sm-6 col-xs-12 hidden-xs'<'toolbar'>>r>" +
                        "t" +
                        "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                "autoWidth": true,
                "preDrawCallback": function () {
                    // Initialize the responsive datatables helper once.
                    if (!responsiveHelper_datatable_fixed_column) {
                        responsiveHelper_datatable_fixed_column = new ResponsiveDatatablesHelper($('#datatable_fixed_column3'), breakpointDefinition);
                    }
                },
                "rowCallback": function (nRow) {
                    responsiveHelper_datatable_fixed_column.createExpandIcon(nRow);
                },
                "drawCallback": function (oSettings) {
                    responsiveHelper_datatable_fixed_column.respond();
                },
                "ajax": "/Equipment/ToList?filter=AvailableDevices&value=&value2=",
                "columns": [
                            { "data": "Device" }
                          , { "data": "Manufacturer" }
                          , { "data": "Model" }
                          , { "data": "SerialNo" }
                          , { "data": "MAC" }
                          , { "data": "UENumber" }
                          , {
                              render: function (data, type, row) {
                                  var permissions = "";
                                  if (IssueUE == "True") {
                                      permissions = '<a href="/equipment/movement?UEId=' + row.UEId + '&UETypeId=' + row.UETypeId + '&UEsts=Issue"><span style="color:green;" title="Assign Device" class="fa fa-hand-o-right"></span></a>' + " &nbsp; " +
                                                    '<a href="#" onclick="return addUEIssue(' + row.UEId + ',' + row.UserId + ');"  data-toggle="modal" data-target="#TaskModalIssues"><span style="color:red;" title="View UE Issue(s)" class="fa fa-exchange"></span></a>'
                                  }
                                  return permissions;
                              }
                          }
                ]
            });
        }
        //

        //get Active OR InActive devices list
        $("#IsActive").click(function () {

            var IsActive = "False";

            if ($(this).is(":checked")) {
                //alert($(this).val());
                IsActive = "False";
            }
            else {
                IsActive = "True";
            }
            LoadUserEquipments(IsActive);
        });


        //Change device status
        function IsActiveUE(SerialNo, IsActive) {
            $.ajax({
                url: '/Equipment/EquipmentStatus?SerialNo=' + SerialNo + '&IsActive=' + IsActive,
                type: 'post',
                success: function (res) {
                    if (res != 'session expired') {
                        if (res.Status == 'success') {
                        } else {
                            $.notify(res.Message, { type: res.Status, color: "#ffffff", background: "#D44950", blur: 0.6, delay: 0, });
                        }
                    } else {
                        //  $.notify('Session Expired. Open New Tab & Login Again. Then Press Save Button.', { type: 'danger', color: "#ffffff", background: "#D44950", blur: 0.6, delay: 0, });
                    }
                }
            });


            $("#datatable_fixed_column").on('click', '.fa-times-circle-o', function () {
                $(this).closest('tr').remove();
            });
            
            $("#datatable_fixed_column").on('click', '.fa-check-circle', function () {
                $(this).closest('tr').remove();
            });

            return false;
        }

        var myUEId = "";
        var myUserId = "";

        function theFunction(UEId, UserId) {
            //alert(UEId + ": " + UserId);

            myUEId = UEId;
            myUserId = UserId;

            LoadModuleApps(UserId)
        }

        function addUEIssue(UEId, UserId) {
            myUEId = UEId;
            myUserId = UserId;

           LoadUEIssues(UEId);
        }

        function LoadModuleApps(UserId) {
            //clear all checkboxes by class
            // $('.chk-module').prop("checked", false);

            $.ajax({
                url: '/Equipment/UserModuleApps/',
                type: 'post',
                data: { UserId: UserId },
                success: function (appIds) {

                    var sApp = appIds.split(',');
                    var i;

                    for (i = 0; i < sApp.length; ++i) {
                        $("#treeview-container").dynatree("getTree").selectKey(sApp[i]);
                    }

                    //if (res.length > 0) {
                    //    for (var i = 0; i < res.length; i++) {
                    //        if ($('#chk-' + res[i].TypeValue).val() == res[i].TypeValue) {
                    //            $('#chk-' + res[i].TypeValue).prop("checked", true);
                    //        }
                    //    }
                    //}

                    //if (res.length > 0) {
                    //    var row = "";
                    //    for (var i = 0; i < res.length; i++) {
                    //        row += '<tr><td><input type="checkbox" id="' + res[i].DefinationId + '"  name="moduleIds" value="' + res[i].DefinationId + '" /></td>' +
                    //                   '<td>' + res[i].DefinationName + '</td>' +
                    //                   '<td><input type="hidden" value="' + res[i].PDefinationId + '" /></td>' +
                    //              '</tr>';
                    //    }
                    //    $('#mytable').append(row);
                    //}
                }
            });
        }

        //function submitForm() {
        //    var checkedValues = [];
        //    $.each($("input[name='moduleIds']:checked"), function () {
        //        checkedValues.push($(this).val());
        //    });

        //    //alert("My checkedValues  are: " + checkedValues.join(", "));

        //    //var tableControl = document.getElementById('mytable');
        //    //var arrayOfValues = [];

        //    //$('input:checkbox:checked', tableControl).each(function () {
        //    //    arrayOfValues.push($(this).closest('tr').find('td:last').text());
        //    //}).get();

        //    $.ajax({
        //        url: "/Equipment/UserApps",
        //        data: { checkedValues: checkedValues, UEId: myUEId, UserId: myUserId },
        //        type: 'post',
        //        success: function () {
        //            //window.location.reload();
        //        }
        //    });
        //}


        function LoadUEIssues(UEId) {
            $('#tblIssues tbody').empty();
            debugger;
            $.ajax({
                url: '/Equipment/UEIssuesList/',
                type: 'post',
                data: { UEId: UEId },
                success: function (res) {
                    if (res.length > 0) {
                        var row = "";
                        for (var i = 0; i < res.length; i++) {

                            var rptDate = new Date(moment.utc(res[i].ReportDate));
                            var strDate = rptDate.getFullYear() + "/" + (rptDate.getMonth() + 1) + "/" + rptDate.getDate();

                            row += '<tr><td>' + res[i].IssueId + '</td>' +
                                       '<td>' + res[i].UEId + '</td>' +
                                       '<td>' + res[i].Description + '</td>' +
                                       '<td>' + strDate + '</td>' +
                                  '</tr>';
                        }
                        $('#tblIssues').append(row);
                    }
                    else {
                        $('#tblIssues').append('<tr><td colspan=4>No Issue Reported.</td></tr>');
                    }
                }
            });
        }
    </script>

    @section style{
        <link href="~/Content/js/Plugins/bootgrid/jquery.bootgrid.css" rel="stylesheet" />
        <link href="~/Content/js/Plugins/ContextMenu/contextMenu.min.css" rel="stylesheet" />
        <style>
            .column-header-anchor {
                color: black !important;
            }

            .smart-form footer {
                padding: 0px;
            }
        </style>
    }
